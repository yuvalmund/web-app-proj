@model IEnumerable<RentAHouse.Models.Apartment>
@using RentAHouse.Models;

@{
    ViewData["Title"] = "Index";
}

<h2>Search for your next house</h2>

<script>
    function onRegionSelected(region) {
        $.post('/Apartments/Index', { region: region }, function (data, status) {
            var cityArray = JSON.parse(data);

            $("#selectCity").empty();

            var sel = $("#selectCity");
            cityArray.forEach(function (city) {
                sel.append($("<option>").attr('value', city.ID).text(city.cityName));
            });
        });
    }

    function onSearch() {
        $.get('/Apartments/GetApartments', function (data) {
            debugger;
            var t = 0;

            var minPrice = $("#minPrice");
            var maxPrice = $("#maxPrice");
            var roomNum = $("#roomNum");
            var city = $("#selectCity");

            //model.filter(function (apartment) {
            //    return apartment.city == city
            //})

            model.sort(function (a, b) {
                return a.price - b.price;
            });

            $("apartmentsTable").empty();
            var table = $("#apartmentsTable");

            model.forEach(function (apartment) {
                var street = apartment.street;


                var markup = "<tr><td>" + street + "</td></tr>";

                $("#tableBody").append(markup);
            });
        });

    }
 </script>
<form>
    <div class="form-group">
        <label for="Region">Which Region?</label>
        <select asp-items="@Html.GetEnumSelectList<District>()" onchange="onRegionSelected(this.value)" class="form-control"></select>    
    </div>
    <div class="form-group">
        <label for="City">Which City?</label>
        <select id="selectCity" asp-items="ViewBag.Cities" class="form-control"></select>
    </div>
    <div class="form-group">
        <label for="RoomNumber">How many rooms?</label>
        <select class="form-control" id="roomNum">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
    </div>
    <div class="form-group">
        <label for="minPrice">Minimum price</label>
        <input type="text" class="form-control" id="minPrice">
    </div>
    <div class="form-group">
        <label for="maxPrice">Maximum price</label>
        <input type="text" class="form-control" id="maxPrice">
    </div>
    <input type="button" class="btn btn-success btn-lg" onclick="onSearch()" value="Search"/>
</form>

<table id="apartmentsTable" class="table">
        <thead>
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.street)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.roomsNumber)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.size)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.price)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.cityTax)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.BuildingTax)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.furnitureInculded)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.isRenovatetd)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.arePetsAllowed)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.isThereElivator)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.EnterDate)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.floor)
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
